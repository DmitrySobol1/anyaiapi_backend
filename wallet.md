# –ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ÆMoney Wallet API (API –∫–æ—à–µ–ª—å–∫–∞)

## üéØ –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ÆMoney Wallet API** ‚Äî —ç—Ç–æ API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–º–∏ –∫–æ—à–µ–ª—å–∫–∞–º–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü. –ü–æ–∑–≤–æ–ª—è–µ—Ç:
- –ü—Ä–∏–Ω–∏–º–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã –Ω–∞ –∫–æ—à–µ–ª–µ–∫
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (P2P)
- –ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –±–∞–ª–∞–Ω—Å –∏ –∏—Å—Ç–æ—Ä–∏—é –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—Ö–æ–¥—è—â–∏—Ö –ø–µ—Ä–µ–≤–æ–¥–∞—Ö

**–í–∞–∂–Ω–æ:** –ß–µ—Ä–µ–∑ API –∫–æ—à–µ–ª—å–∫–∞ –Ω–µ–ª—å–∑—è –ø—Ä–∏–Ω–∏–º–∞—Ç—å –¥–µ–Ω—å–≥–∏ –Ω–∞ –±–∞–Ω–∫–æ–≤—Å–∫–∏–π —Å—á–µ—Ç –∫–æ–º–ø–∞–Ω–∏–∏, —Ç–æ–ª—å–∫–æ –≤ –∫–æ—à–µ–ª–µ–∫ —Ñ–∏–∑–ª–∏—Ü–∞.

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Backend: Node.js + Express
- Frontend: React + TypeScript
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: MongoDB
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: OAuth 2.0

---

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ—à–µ–ª—å–∫–∞ –ÆMoney

```
–ó–ê–î–ê–ß–ê 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–æ—à–µ–ª–µ–∫

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ—à–µ–ª–µ–∫ –Ω–∞ https://yoomoney.ru
2. –ü—Ä–æ–π—Ç–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é (—Å—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "–∏–º–µ–Ω–Ω–æ–π" –∏–ª–∏ "–∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π")
   - –° –∞–Ω–æ–Ω–∏–º–Ω—ã–º –∫–æ—à–µ–ª—å–∫–æ–º –Ω–µ–ª—å–∑—è –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏!
3. –ó–∞–ø–æ–º–Ω–∏—Ç—å –Ω–æ–º–µ—Ä –∫–æ—à–µ–ª—å–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 410011234567890)
```

### 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
–ó–ê–î–ê–ß–ê 2: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://yoomoney.ru/myservices/new
2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ:
   - –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: "NC-Solutions Payment System"
   - –ê–¥—Ä–µ—Å —Å–∞–π—Ç–∞: https://nc-solutions.ru (–∏–ª–∏ –≤–∞—à –¥–æ–º–µ–Ω)
   - Redirect URI: https://nc-solutions.ru/oauth/callback
   - –ü–æ—á—Ç–∞ –¥–ª—è —Å–≤—è–∑–∏: –≤–∞—à–∞ –ø–æ—á—Ç–∞
   - ‚úÖ –ü–æ—Å—Ç–∞–≤–∏—Ç—å –≥–∞–ª–æ—á–∫—É "–ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (OAuth2 client_secret)"
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ SMS
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
   - client_id (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
   - client_secret (—Å–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–ª–æ–≤–æ)
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# Backend
npm install axios uuid crypto --save
npm install dotenv --save

# –î–ª—è —Ä–∞–±–æ—Ç—ã —Å MongoDB
npm install mongoose --save
```

---

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: Backend - OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

#### –§–∞–π–ª 1: `/backend/.env`

```env
# –ÆMoney OAuth
YOOMONEY_CLIENT_ID=your_client_id_here
YOOMONEY_CLIENT_SECRET=your_client_secret_here
YOOMONEY_REDIRECT_URI=https://nc-solutions.ru/oauth/callback
YOOMONEY_WALLET_NUMBER=410011234567890

# –°–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
YOOMONEY_NOTIFICATION_SECRET=your_secret_word_here

# URLs
FRONTEND_URL=http://localhost:3000
BACKEND_URL=http://localhost:5000
```

#### –§–∞–π–ª 2: `/backend/config/yoomoney.js`

```javascript
// –ó–ê–î–ê–ß–ê: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ÆMoney API

const axios = require('axios');

const YOOMONEY_AUTH_URL = 'https://yoomoney.ru/oauth/authorize';
const YOOMONEY_TOKEN_URL = 'https://yoomoney.ru/oauth/token';
const YOOMONEY_API_URL = 'https://yoomoney.ru/api';

class YooMoneyAPI {
  constructor(accessToken = null) {
    this.accessToken = accessToken;
    this.clientId = process.env.YOOMONEY_CLIENT_ID;
    this.clientSecret = process.env.YOOMONEY_CLIENT_SECRET;
    this.redirectUri = process.env.YOOMONEY_REDIRECT_URI;
  }

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è URL –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  getAuthorizationUrl(scope) {
    const params = new URLSearchParams({
      client_id: this.clientId,
      response_type: 'code',
      redirect_uri: this.redirectUri,
      scope: scope.join(' ')
    });
    
    return `${YOOMONEY_AUTH_URL}?${params.toString()}`;
  }

  // –û–±–º–µ–Ω –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –Ω–∞ access_token
  async getAccessToken(code) {
    try {
      const response = await axios.post(YOOMONEY_TOKEN_URL, 
        new URLSearchParams({
          code: code,
          client_id: this.clientId,
          grant_type: 'authorization_code',
          redirect_uri: this.redirectUri,
          client_secret: this.clientSecret
        }),
        {
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        }
      );
      
      return response.data.access_token;
    } catch (error) {
      console.error('Error getting access token:', error.response?.data);
      throw error;
    }
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ—à–µ–ª—å–∫–µ
  async getAccountInfo() {
    try {
      const response = await axios.post(
        `${YOOMONEY_API_URL}/account-info`,
        {},
        {
          headers: {
            'Authorization': `Bearer ${this.accessToken}`,
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        }
      );
      
      return response.data;
    } catch (error) {
      console.error('Error getting account info:', error.response?.data);
      throw error;
    }
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
  async getOperationHistory(params = {}) {
    try {
      const response = await axios.post(
        `${YOOMONEY_API_URL}/operation-history`,
        new URLSearchParams(params),
        {
          headers: {
            'Authorization': `Bearer ${this.accessToken}`,
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        }
      );
      
      return response.data;
    } catch (error) {
      console.error('Error getting operation history:', error.response?.data);
      throw error;
    }
  }

  // –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞)
  async requestPayment(params) {
    try {
      const response = await axios.post(
        `${YOOMONEY_API_URL}/request-payment`,
        new URLSearchParams(params),
        {
          headers: {
            'Authorization': `Bearer ${this.accessToken}`,
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        }
      );
      
      return response.data;
    } catch (error) {
      console.error('Error requesting payment:', error.response?.data);
      throw error;
    }
  }

  // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
  async processPayment(requestId, moneySource = 'wallet', csc = null) {
    try {
      const params = {
        request_id: requestId
      };
      
      if (moneySource === 'wallet') {
        params.money_source = 'wallet';
      } else {
        params.money_source = moneySource;
        if (csc) {
          params.csc = csc;
        }
      }
      
      const response = await axios.post(
        `${YOOMONEY_API_URL}/process-payment`,
        new URLSearchParams(params),
        {
          headers: {
            'Authorization': `Bearer ${this.accessToken}`,
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        }
      );
      
      return response.data;
    } catch (error) {
      console.error('Error processing payment:', error.response?.data);
      throw error;
    }
  }
}

module.exports = YooMoneyAPI;
```

#### –§–∞–π–ª 3: `/backend/models/YooMoneyToken.js`

```javascript
// –ó–ê–î–ê–ß–ê: –ú–æ–¥–µ–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è OAuth —Ç–æ–∫–µ–Ω–æ–≤

const mongoose = require('mongoose');

const YooMoneyTokenSchema = new mongoose.Schema({
  // –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–æ—à–µ–ª—å–∫–∞)
  userId: {
    type: String,
    required: true,
    unique: true,
    default: 'admin' // –î–ª—è NC-Solutions –±—É–¥–µ—Ç –æ–¥–∏–Ω –æ—Å–Ω–æ–≤–Ω–æ–π –∞–∫–∫–∞—É–Ω—Ç
  },
  
  // Access token –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
  accessToken: {
    type: String,
    required: true
  },
  
  // –ù–æ–º–µ—Ä –∫–æ—à–µ–ª—å–∫–∞
  walletNumber: String,
  
  // Scope (—Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è)
  scope: [String],
  
  // –î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
  createdAt: {
    type: Date,
    default: Date.now
  },
  
  // –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
  lastUsedAt: {
    type: Date,
    default: Date.now
  }
});

module.exports = mongoose.model('YooMoneyToken', YooMoneyTokenSchema);
```

#### –§–∞–π–ª 4: `/backend/models/IncomingTransfer.js`

```javascript
// –ó–ê–î–ê–ß–ê: –ú–æ–¥–µ–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤

const mongoose = require('mongoose');

const IncomingTransferSchema = new mongoose.Schema({
  // ID –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—Ç –ÆMoney
  operationId: {
    type: String,
    required: true,
    unique: true
  },
  
  // –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  notificationType: {
    type: String,
    default: 'p2p-incoming'
  },
  
  // –°—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞
  amount: {
    type: Number,
    required: true
  },
  
  // –°—É–º–º–∞ —Å–ø–∏—Å–∞–Ω–∏—è —É –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (—Å –∫–æ–º–∏—Å—Å–∏–µ–π)
  withdrawAmount: Number,
  
  // –í–∞–ª—é—Ç–∞ (643 = RUB)
  currency: {
    type: String,
    default: '643'
  },
  
  // –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–∏
  datetime: {
    type: Date,
    required: true
  },
  
  // –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å
  sender: String,
  
  // –ó–∞—â–∏—Ç–∞ –∫–æ–¥–æ–º
  codepro: {
    type: Boolean,
    default: false
  },
  
  // –ú–µ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ (label)
  label: String,
  
  // –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
  senderData: {
    lastname: String,
    firstname: String,
    fathersname: String,
    email: String,
    phone: String,
    city: String,
    street: String,
    building: String,
    suite: String,
    flat: String,
    zip: String
  },
  
  // –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
  processed: {
    type: Boolean,
    default: false
  },
  
  // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram
  telegramNotified: {
    type: Boolean,
    default: false
  },
  
  // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
  createdAt: {
    type: Date,
    default: Date.now
  }
});

module.exports = mongoose.model('IncomingTransfer', IncomingTransferSchema);
```

#### –§–∞–π–ª 5: `/backend/routes/yoomoney.js`

```javascript
// –ó–ê–î–ê–ß–ê: API endpoints –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ÆMoney

const express = require('express');
const router = express.Router();
const YooMoneyAPI = require('../config/yoomoney');
const YooMoneyToken = require('../models/YooMoneyToken');
const IncomingTransfer = require('../models/IncomingTransfer');
const crypto = require('crypto');

// GET /api/yoomoney/auth - –ù–∞—á–∞–ª–æ OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
router.get('/auth', (req, res) => {
  const yoomoney = new YooMoneyAPI();
  
  // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –ø—Ä–∞–≤–∞ (scope)
  const scope = [
    'account-info',           // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—á–µ—Ç–µ
    'operation-history',      // –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
    'operation-details',      // –î–µ—Ç–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
    'incoming-transfers',     // –í—Ö–æ–¥—è—â–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã
    'payment-p2p'            // P2P –ø–µ—Ä–µ–≤–æ–¥—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å)
  ];
  
  const authUrl = yoomoney.getAuthorizationUrl(scope);
  
  // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ÆMoney
  res.redirect(authUrl);
});

// GET /api/yoomoney/callback - –û–±—Ä–∞–±–æ—Ç–∫–∞ callback –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
router.get('/callback', async (req, res) => {
  try {
    const { code, error } = req.query;
    
    if (error) {
      return res.status(400).json({
        success: false,
        error: 'Authorization denied'
      });
    }
    
    if (!code) {
      return res.status(400).json({
        success: false,
        error: 'No authorization code received'
      });
    }
    
    // –û–±–º–µ–Ω–∏–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–¥ –Ω–∞ access_token
    const yoomoney = new YooMoneyAPI();
    const accessToken = await yoomoney.getAccessToken(code);
    
    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ—à–µ–ª—å–∫–µ
    const apiWithToken = new YooMoneyAPI(accessToken);
    const accountInfo = await apiWithToken.getAccountInfo();
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
    await YooMoneyToken.findOneAndUpdate(
      { userId: 'admin' },
      {
        accessToken: accessToken,
        walletNumber: accountInfo.account,
        scope: ['account-info', 'operation-history', 'operation-details', 'incoming-transfers', 'payment-p2p'],
        lastUsedAt: new Date()
      },
      { upsert: true, new: true }
    );
    
    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Å —É—Å–ø–µ—à–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
    res.redirect(`${process.env.FRONTEND_URL}/admin/yoomoney-success`);
    
  } catch (error) {
    console.error('OAuth callback error:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

// GET /api/yoomoney/balance - –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∫–æ—à–µ–ª—å–∫–∞
router.get('/balance', async (req, res) => {
  try {
    const tokenData = await YooMoneyToken.findOne({ userId: 'admin' });
    
    if (!tokenData) {
      return res.status(401).json({
        success: false,
        error: 'Not authorized. Please authorize first.'
      });
    }
    
    const yoomoney = new YooMoneyAPI(tokenData.accessToken);
    const accountInfo = await yoomoney.getAccountInfo();
    
    res.json({
      success: true,
      account: accountInfo.account,
      balance: accountInfo.balance,
      currency: accountInfo.currency,
      accountStatus: accountInfo.account_status,
      accountType: accountInfo.account_type
    });
    
  } catch (error) {
    console.error('Balance error:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

// GET /api/yoomoney/history - –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –æ–ø–µ—Ä–∞—Ü–∏–π
router.get('/history', async (req, res) => {
  try {
    const tokenData = await YooMoneyToken.findOne({ userId: 'admin' });
    
    if (!tokenData) {
      return res.status(401).json({
        success: false,
        error: 'Not authorized'
      });
    }
    
    const yoomoney = new YooMoneyAPI(tokenData.accessToken);
    const history = await yoomoney.getOperationHistory({
      records: req.query.records || 30,
      type: req.query.type || undefined, // 'deposition', 'payment', 'incoming-transfers-unaccepted'
      label: req.query.label || undefined
    });
    
    res.json({
      success: true,
      operations: history.operations,
      nextRecord: history.next_record
    });
    
  } catch (error) {
    console.error('History error:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

// POST /api/yoomoney/webhook - Webhook –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤
router.post('/webhook', async (req, res) => {
  try {
    const notification = req.body;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    const isValid = verifyNotification(notification);
    
    if (!isValid) {
      return res.status(403).json({ error: 'Invalid notification signature' });
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ö–æ–¥—è—â–µ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞
    const transfer = new IncomingTransfer({
      operationId: notification.operation_id,
      notificationType: notification.notification_type,
      amount: parseFloat(notification.amount),
      withdrawAmount: parseFloat(notification.withdraw_amount),
      currency: notification.currency,
      datetime: new Date(notification.datetime),
      sender: notification.sender,
      codepro: notification.codepro === 'true',
      label: notification.label,
      senderData: {
        lastname: notification.lastname,
        firstname: notification.firstname,
        fathersname: notification.fathersname,
        email: notification.email,
        phone: notification.phone,
        city: notification.city,
        street: notification.street,
        building: notification.building,
        suite: notification.suite,
        flat: notification.flat,
        zip: notification.zip
      }
    });
    
    await transfer.save();
    
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
    // await sendTelegramNotification(transfer);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º HTTP 200 OK –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è
    res.status(200).send('OK');
    
  } catch (error) {
    // –ï—Å–ª–∏ —ç—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç (—É–∂–µ –µ—Å—Ç—å –≤ –±–∞–∑–µ), –≤—Å–µ —Ä–∞–≤–Ω–æ –æ—Ç–≤–µ—á–∞–µ–º 200
    if (error.code === 11000) {
      return res.status(200).send('OK');
    }
    
    console.error('Webhook error:', error);
    res.status(500).json({ error: error.message });
  }
});

// –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
function verifyNotification(notification) {
  const {
    notification_type,
    operation_id,
    amount,
    currency,
    datetime,
    sender,
    codepro,
    label
  } = notification;
  
  const sha1Hash = notification.sha1_hash;
  const secret = process.env.YOOMONEY_NOTIFICATION_SECRET;
  
  // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
  let str = `${notification_type}&${operation_id}&${amount}&${currency}&${datetime}&${sender}&${codepro}&${secret}&`;
  
  if (label) {
    str += label;
  }
  
  // –í—ã—á–∏—Å–ª—è–µ–º SHA-1 —Ö–µ—à
  const hash = crypto.createHash('sha1').update(str).digest('hex');
  
  return hash === sha1Hash;
}

module.exports = router;
```

#### –§–∞–π–ª 6: `/backend/server.js` (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)

```javascript
// –ó–ê–î–ê–ß–ê: –î–æ–±–∞–≤–∏—Ç—å yoomoney routes –≤ –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞

const express = require('express');
const cors = require('cors');
require('dotenv').config();

const app = express();

// Middleware
app.use(cors());
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Routes
const yoomoneyRoutes = require('./routes/yoomoney');
app.use('/api/yoomoney', yoomoneyRoutes);

// –û—Å—Ç–∞–ª—å–Ω—ã–µ routes...

const PORT = process.env.PORT || 5000;
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});
```

---

### –≠—Ç–∞–ø 2: Frontend - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

#### –§–∞–π–ª 7: `/src/pages/admin/YooMoneyDashboard.tsx`

```typescript
// –ó–ê–î–ê–ß–ê: –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ÆMoney

import React, { useEffect, useState } from 'react';
import axios from 'axios';

interface AccountInfo {
  account: string;
  balance: number;
  currency: string;
  accountStatus: string;
  accountType: string;
}

interface Operation {
  operation_id: string;
  title: string;
  amount: number;
  direction: 'in' | 'out';
  datetime: string;
  status: string;
  type: string;
}

const API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000';

export const YooMoneyDashboard: React.FC = () => {
  const [accountInfo, setAccountInfo] = useState<AccountInfo | null>(null);
  const [operations, setOperations] = useState<Operation[]>([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    loadBalance();
    loadHistory();
  }, []);

  const loadBalance = async () => {
    setLoading(true);
    try {
      const response = await axios.get(`${API_URL}/api/yoomoney/balance`);
      if (response.data.success) {
        setAccountInfo(response.data);
      }
    } catch (err: any) {
      setError(err.response?.data?.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–ª–∞–Ω—Å–∞');
    } finally {
      setLoading(false);
    }
  };

  const loadHistory = async () => {
    try {
      const response = await axios.get(`${API_URL}/api/yoomoney/history?records=20`);
      if (response.data.success) {
        setOperations(response.data.operations);
      }
    } catch (err: any) {
      console.error('Error loading history:', err);
    }
  };

  const handleAuthorize = () => {
    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ endpoint –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    window.location.href = `${API_URL}/api/yoomoney/auth`;
  };

  if (loading) {
    return <div className="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>;
  }

  if (error && error.includes('Not authorized')) {
    return (
      <div className="yoomoney-dashboard">
        <h1>–ÆMoney - –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h1>
        <p>–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ—à–µ–ª—å–∫–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è</p>
        <button onClick={handleAuthorize} className="btn-primary">
          –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ –ÆMoney
        </button>
      </div>
    );
  }

  return (
    <div className="yoomoney-dashboard">
      <h1>–ÆMoney –ö–æ—à–µ–ª–µ–∫</h1>

      {accountInfo && (
        <div className="account-info">
          <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ—à–µ–ª—å–∫–µ</h2>
          <div className="info-grid">
            <div className="info-item">
              <label>–ù–æ–º–µ—Ä –∫–æ—à–µ–ª—å–∫–∞:</label>
              <span>{accountInfo.account}</span>
            </div>
            <div className="info-item">
              <label>–ë–∞–ª–∞–Ω—Å:</label>
              <span className="balance">{accountInfo.balance} ‚ÇΩ</span>
            </div>
            <div className="info-item">
              <label>–°—Ç–∞—Ç—É—Å:</label>
              <span>{accountInfo.accountStatus}</span>
            </div>
            <div className="info-item">
              <label>–¢–∏–ø:</label>
              <span>{accountInfo.accountType}</span>
            </div>
          </div>
        </div>
      )}

      <div className="operations-history">
        <h2>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
        <button onClick={loadHistory} className="btn-secondary">
          –û–±–Ω–æ–≤–∏—Ç—å
        </button>
        
        {operations.length > 0 ? (
          <table className="operations-table">
            <thead>
              <tr>
                <th>–î–∞—Ç–∞</th>
                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th>–°—É–º–º–∞</th>
                <th>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
              </tr>
            </thead>
            <tbody>
              {operations.map((op) => (
                <tr key={op.operation_id}>
                  <td>{new Date(op.datetime).toLocaleString('ru-RU')}</td>
                  <td>{op.title}</td>
                  <td className={op.direction === 'in' ? 'amount-in' : 'amount-out'}>
                    {op.direction === 'in' ? '+' : '-'}{op.amount} ‚ÇΩ
                  </td>
                  <td>{op.direction === 'in' ? '–í—Ö–æ–¥—è—â–∏–π' : '–ò—Å—Ö–æ–¥—è—â–∏–π'}</td>
                  <td>{op.status}</td>
                </tr>
              ))}
            </tbody>
          </table>
        ) : (
          <p>–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</p>
        )}
      </div>
    </div>
  );
};
```

#### –§–∞–π–ª 8: `/src/pages/admin/YooMoneyDashboard.css`

```css
/* –ó–ê–î–ê–ß–ê: –°—Ç–∏–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ –ÆMoney */

.yoomoney-dashboard {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.yoomoney-dashboard h1 {
  font-size: 32px;
  margin-bottom: 30px;
  color: #333;
}

.account-info {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 30px;
}

.account-info h2 {
  font-size: 24px;
  margin-bottom: 20px;
  color: #333;
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
}

.info-item {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.info-item label {
  font-weight: 600;
  color: #666;
  font-size: 14px;
}

.info-item span {
  font-size: 18px;
  color: #333;
}

.info-item .balance {
  font-size: 28px;
  font-weight: 700;
  color: #28a745;
}

.operations-history {
  background: white;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.operations-history h2 {
  font-size: 24px;
  margin-bottom: 20px;
  color: #333;
}

.operations-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

.operations-table thead {
  background: #f8f9fa;
}

.operations-table th {
  padding: 12px;
  text-align: left;
  font-weight: 600;
  color: #666;
  border-bottom: 2px solid #dee2e6;
}

.operations-table td {
  padding: 12px;
  border-bottom: 1px solid #dee2e6;
}

.operations-table tr:hover {
  background: #f8f9fa;
}

.amount-in {
  color: #28a745;
  font-weight: 600;
}

.amount-out {
  color: #dc3545;
  font-weight: 600;
}

.btn-primary {
  background: #8b3ffd;
  color: white;
  padding: 12px 24px;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-primary:hover {
  background: #7a35e0;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(139, 63, 253, 0.3);
}

.btn-secondary {
  background: #6c757d;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-secondary:hover {
  background: #5a6268;
}

.loading {
  text-align: center;
  padding: 40px;
  font-size: 18px;
  color: #666;
}
```

---

### –≠—Ç–∞–ø 3: –§–æ—Ä–º–∞ –æ–ø–ª–∞—Ç—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤

#### –§–∞–π–ª 9: `/src/components/YooMoneyPaymentForm.tsx`

```typescript
// –ó–ê–î–ê–ß–ê: –ü—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –Ω–∞ –∫–æ—à–µ–ª–µ–∫

import React from 'react';
import './YooMoneyPaymentForm.css';

interface YooMoneyPaymentFormProps {
  walletNumber: string; // –ù–æ–º–µ—Ä –≤–∞—à–µ–≥–æ –∫–æ—à–µ–ª—å–∫–∞
  amount?: number;
  description: string;
}

export const YooMoneyPaymentForm: React.FC<YooMoneyPaymentFormProps> = ({
  walletNumber,
  amount,
  description
}) => {
  const copyToClipboard = (text: string) => {
    navigator.clipboard.writeText(text);
    alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
  };

  return (
    <div className="yoomoney-payment-form">
      <h3>–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –ÆMoney</h3>
      <p>–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –¥–µ–Ω—å–≥–∏ –Ω–∞ –∫–æ—à–µ–ª–µ–∫:</p>
      
      <div className="payment-details">
        <div className="detail-item">
          <strong>–ù–æ–º–µ—Ä –∫–æ—à–µ–ª—å–∫–∞:</strong>
          <span className="wallet-number">{walletNumber}</span>
          <button 
            onClick={() => copyToClipboard(walletNumber)}
            className="btn-copy"
          >
            üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å
          </button>
        </div>
        
        {amount && (
          <div className="detail-item">
            <strong>–°—É–º–º–∞:</strong>
            <span className="amount">{amount} ‚ÇΩ</span>
          </div>
        )}
        
        <div className="detail-item">
          <strong>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞:</strong>
          <span className="description">{description}</span>
        </div>
      </div>

      <div className="payment-instructions">
        <h4>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ–ø–ª–∞—Ç–µ:</h4>
        <ol>
          <li>–í–æ–π–¥–∏—Ç–µ –≤ –≤–∞—à –∫–æ—à–µ–ª–µ–∫ –ÆMoney</li>
          <li>–í—ã–±–µ—Ä–∏—Ç–µ "–ü–µ—Ä–µ–≤–µ—Å—Ç–∏"</li>
          <li>–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–æ—à–µ–ª—å–∫–∞: <code>{walletNumber}</code></li>
          {amount && <li>–£–∫–∞–∂–∏—Ç–µ —Å—É–º–º—É: <strong>{amount} ‚ÇΩ</strong></li>}
          <li>–í –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —É–∫–∞–∂–∏—Ç–µ: {description}</li>
          <li>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥</li>
        </ol>
      </div>

      <a 
        href={`https://yoomoney.ru/to/${walletNumber}`}
        target="_blank"
        rel="noopener noreferrer"
        className="btn-primary btn-pay"
      >
        üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ –ÆMoney
      </a>
    </div>
  );
};
```

#### –§–∞–π–ª 10: `/src/components/YooMoneyPaymentForm.css`

```css
/* –ó–ê–î–ê–ß–ê: –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã –æ–ø–ª–∞—Ç—ã */

.yoomoney-payment-form {
  max-width: 600px;
  margin: 0 auto;
  padding: 30px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.yoomoney-payment-form h3 {
  font-size: 24px;
  margin-bottom: 10px;
  color: #333;
}

.yoomoney-payment-form > p {
  color: #666;
  margin-bottom: 20px;
}

.payment-details {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 30px;
}

.detail-item {
  margin-bottom: 15px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.detail-item:last-child {
  margin-bottom: 0;
}

.detail-item strong {
  color: #666;
  font-size: 14px;
}

.wallet-number {
  font-family: 'Courier New', monospace;
  font-size: 20px;
  font-weight: 700;
  color: #8b3ffd;
  letter-spacing: 1px;
}

.amount {
  font-size: 28px;
  font-weight: 700;
  color: #28a745;
}

.description {
  color: #333;
  font-size: 16px;
}

.btn-copy {
  background: #6c757d;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.3s;
  width: fit-content;
}

.btn-copy:hover {
  background: #5a6268;
}

.payment-instructions {
  margin-bottom: 30px;
}

.payment-instructions h4 {
  font-size: 18px;
  margin-bottom: 15px;
  color: #333;
}

.payment-instructions ol {
  padding-left: 20px;
}

.payment-instructions li {
  margin-bottom: 10px;
  color: #666;
  line-height: 1.6;
}

.payment-instructions code {
  background: #f8f9fa;
  padding: 2px 8px;
  border-radius: 4px;
  font-family: 'Courier New', monospace;
  color: #8b3ffd;
}

.btn-pay {
  display: block;
  width: 100%;
  text-align: center;
  background: #8b3ffd;
  color: white;
  padding: 16px 24px;
  border: none;
  border-radius: 8px;
  font-size: 18px;
  font-weight: 700;
  text-decoration: none;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-pay:hover {
  background: #7a35e0;
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(139, 63, 253, 0.3);
}
```

---

## üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ó–∞–¥–∞—á–∞: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –ÆMoney

```
1. –í–æ–π—Ç–∏ –≤ –∫–æ—à–µ–ª–µ–∫ –ÆMoney
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
3. –£–∫–∞–∑–∞—Ç—å URL: https://nc-solutions.ru/api/yoomoney/webhook
4. –£–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–ª–æ–≤–æ (—Ç–æ –∂–µ, —á—Ç–æ –≤ .env YOOMONEY_NOTIFICATION_SECRET)
5. –í—ã–±—Ä–∞—Ç—å —Å–æ–±—ã—Ç–∏—è:
   ‚úÖ p2p-incoming (–≤—Ö–æ–¥—è—â–∏–π P2P –ø–µ—Ä–µ–≤–æ–¥)
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚úÖ –û—Ç–∫—Ä—ã—Ç—å /api/yoomoney/auth
‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ –ÆMoney
‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ –ë–î

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
‚úÖ –û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

# 3. –¢–µ—Å—Ç–æ–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥
‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ —Å–≤–æ–π –∫–æ—à–µ–ª–µ–∫
‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ webhook
‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram

# 4. –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∏—Å—Ç–æ—Ä–∏–∏
‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É –æ–ø–µ—Ä–∞—Ü–∏–π
```

---

## üìä –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### –í–ê–†–ò–ê–ù–¢ 1: –ü—Ä–∏–µ–º –ø–µ—Ä–µ–≤–æ–¥–æ–≤ (–ø—Ä–æ—Å—Ç–æ–π)

```
1. –ö–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç –Ω–æ–º–µ—Ä –≤–∞—à–µ–≥–æ –∫–æ—à–µ–ª—å–∫–∞ –Ω–∞ —Å–∞–π—Ç–µ
   ‚Üì
2. –ö–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –¥–µ–Ω—å–≥–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –ÆMoney
   ‚Üì
3. –ÆMoney –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
   ‚Üì
4. –°–µ—Ä–≤–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–µ—Ä–µ–≤–æ–¥–µ –≤ –ë–î
   ‚Üì
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
   ‚Üì
6. –í—ã –≤—Ä—É—á–Ω—É—é –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã
```

### –í–ê–†–ò–ê–ù–¢ 2: OAuth + –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (—Å–ª–æ–∂–Ω—ã–π)

```
1. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ OAuth (–æ–¥–∏–Ω —Ä–∞–∑)
   ‚Üì
2. –°–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç access_token
   ‚Üì
3. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –æ–ø–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ API
   ‚Üì
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã —Å –∑–∞–∫–∞–∑–∞–º–∏
   ‚Üì
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º
   ‚Üì
6. –ú–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤–æ–∑–≤—Ä–∞—Ç—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ÆMoney Wallet API

### –õ–∏–º–∏—Ç—ã –¥–ª—è –∫–æ—à–µ–ª—å–∫–æ–≤:

```
–ê–Ω–æ–Ω–∏–º–Ω—ã–π –∫–æ—à–µ–ª–µ–∫:
- –ë–∞–ª–∞–Ω—Å: –¥–æ 15,000 ‚ÇΩ
- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: –¥–æ 15,000 ‚ÇΩ –≤ –º–µ—Å—è—Ü
- ‚ùå –ù–µ–ª—å–∑—è –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã!

–ò–º–µ–Ω–Ω–æ–π –∫–æ—à–µ–ª–µ–∫:
- –ë–∞–ª–∞–Ω—Å: –¥–æ 60,000 ‚ÇΩ
- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: –¥–æ 200,000 ‚ÇΩ –≤ –º–µ—Å—è—Ü

–ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ—à–µ–ª–µ–∫:
- –ë–∞–ª–∞–Ω—Å: –¥–æ 500,000 ‚ÇΩ
- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: –¥–æ 600,000 ‚ÇΩ –≤ –º–µ—Å—è—Ü
```

### –ö–æ–º–∏—Å—Å–∏–∏:

```
P2P –ø–µ—Ä–µ–≤–æ–¥—ã:
- –° –∫–æ—à–µ–ª—å–∫–∞ –Ω–∞ –∫–æ—à–µ–ª–µ–∫: 0.5% (–º–∏–Ω. 0 ‚ÇΩ)
- –° –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç—ã: –æ—Ç 2% + 30 ‚ÇΩ
```

---

## üöÄ –ü–æ—Ä—è–¥–æ–∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –î–µ–Ω—å 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∫–æ—à–µ–ª–µ–∫ –ÆMoney
2. ‚úÖ –ü—Ä–æ–π—Ç–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
3. ‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
4. ‚úÖ –ü–æ–ª—É—á–∏—Ç—å client_id –∏ client_secret
5. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –î–µ–Ω—å 2: Backend
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é YooMoneyAPI
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª–∏ –¥–ª—è –ë–î (YooMoneyToken, IncomingTransfer)
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å routes –¥–ª—è OAuth –∏ API
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ Postman

### –î–µ–Ω—å 3: Webhook –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
1. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook endpoint
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –ÆMoney
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
4. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å Telegram –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –î–µ–Ω—å 4: Frontend
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (YooMoneyDashboard)
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Ñ–æ—Ä–º—É –æ–ø–ª–∞—Ç—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (YooMoneyPaymentForm)
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∏–ª–∏
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å flow

### –î–µ–Ω—å 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫
1. ‚úÖ –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–ø—Ä–æ–≤–µ—Ä–∫–∞ signature –≤ webhook)
3. ‚úÖ –î–µ–ø–ª–æ–π –Ω–∞ production
4. ‚úÖ –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ production

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã

### –ÆMoney Wallet API –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- ‚úÖ –ü—Ä–∏–µ–º–∞ P2P –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –æ—Ç —Ñ–∏–∑–ª–∏—Ü
- ‚úÖ –ù–µ–±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π (–¥–æ 600,000 ‚ÇΩ/–º–µ—Å)
- ‚úÖ –†—É—á–Ω–æ–≥–æ –∏–ª–∏ –ø–æ–ª—É–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É—á–µ—Ç–∞
- ‚úÖ –ü—Ä–æ—Å—Ç—ã—Ö —Å—Ö–µ–º –æ–ø–ª–∞—Ç—ã –±–µ–∑ —á–µ–∫–æ–≤

### –ù–ï –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- ‚ùå –ü—Ä–∏–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –Ω–∞ –±–∞–Ω–∫–æ–≤—Å–∫–∏–π —Å—á–µ—Ç –∫–æ–º–ø–∞–Ω–∏–∏
- ‚ùå –ë–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ (–Ω—É–∂–Ω–∞ –ÆKassa)
- ‚ùå –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π —Å —á–µ–∫–∞–º–∏
- ‚ùå –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü (–Ω—É–∂–Ω–∞ –ÆKassa)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è NC-Solutions:

**–ï—Å–ª–∏ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ –∫–∞–∫ –ò–ü –∏–ª–∏ —é—Ä–ª–∏—Ü–æ –∏ –Ω—É–∂–Ω—ã:**
- –ß–µ–∫–∏ –¥–ª—è –Ω–∞–ª–æ–≥–æ–≤–æ–π (54-–§–ó)
- –ü—Ä–∏–µ–º –Ω–∞ —Ä–∞—Å—á–µ—Ç–Ω—ã–π —Å—á–µ—Ç
- –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- –ë–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã –ø–ª–∞—Ç–µ–∂–µ–π

**‚Üí –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ÆKassa –≤–º–µ—Å—Ç–æ –ÆMoney Wallet API**

**–ï—Å–ª–∏ –≤—ã —Ñ–∏–∑–ª–∏—Ü–æ –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –Ω–µ–±–æ–ª—å—à–∏–µ –ø–ª–∞—Ç–µ–∂–∏ –æ—Ç –¥—Ä—É–∑–µ–π/–∑–Ω–∞–∫–æ–º—ã—Ö:**
- –î–æ 600,000 ‚ÇΩ –≤ –º–µ—Å—è—Ü
- –ë–µ–∑ —á–µ–∫–æ–≤
- –ü—Ä–æ—Å—Ç–∞—è —Å—Ö–µ–º–∞

**‚Üí –ÆMoney Wallet API –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥–æ–π–¥–µ—Ç**

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ÆMoney Wallet API](https://yoomoney.ru/docs/wallet)
- [–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](https://yoomoney.ru/myservices/new)
- [OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è](https://yoomoney.ru/docs/wallet/using-api/authorization/basics)
- [HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è](https://yoomoney.ru/docs/wallet/using-api/notification-p2p-incoming)
- [–ú–µ—Ç–æ–¥—ã API](https://yoomoney.ru/docs/wallet/user-account/account-info)

---

## üéØ –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

```
‚úÖ –ö–æ—à–µ–ª–µ–∫ —Å–æ–∑–¥–∞–Ω –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ
‚úÖ client_id –∏ client_secret –ø–æ–ª—É—á–µ–Ω—ã
‚úÖ Backend –Ω–∞–ø–∏—Å–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
‚úÖ OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ Webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω
‚úÖ Frontend —Å–æ–∑–¥–∞–Ω
‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –í—Å–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ dev –æ–∫—Ä—É–∂–µ–Ω–∏–∏
‚úÖ –î–µ–ø–ª–æ–π –Ω–∞ production –≤—ã–ø–æ–ª–Ω–µ–Ω
‚úÖ –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ
```

---

**–£–¥–∞—á–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π! üöÄ**